function [st,preds,nsr] = ProcessTsSr(Xj,predictionsCount,systemCriterians,newSystemCriterian,criterianSize)
%st - status
%st = 0 ok
%st = 1 not normal distribution
%st = 2 error in shewhart maps

%preds - predictions
%pc - predictions count

%special reason is matrix where columns is sr
%nsr - new special reason
%nsrl - nsr len

st = 0;
preds = [];
nsr = [];

%normal distribution check
dist = CheckNd(Xj);
if ~dist
    Xj = boxcox(0.05, Xj')';
    dist = CheckNd(Xj);
    
    if ~dist
        st = 1;
        return;
    end
end

%создаем карты шухкарта
[X, R] = CreateIndScmParam(Xj, 0.01);
state = false;

%проверяем карту на 8 основных критериев
for j=1:8
    [is_uc, num] = CheckMap(struct('type',j,'ts',[]), X)
    state = state || is_uc;
    
    if is_uc
       nsrv = ToSP(Xj(bg:num), Xlcl, lA, lB, lC, uC, uB, uA);

       nsrvl = length(nsrv);
       if nsrvl < nsrl
           nsrv = [zeros(1,nsrl-nsrvl+1)-1,nsrv];
       end
       nsr = [nsr, nsrv'];
    end
end

%проверяем карту на системные криетрии
%for j=1:size(sr,2)
%    [is_uc] = Check4SpecialResons(Xj, [9,sr(:,j)'], Xlcl, lA, lB, lC, uC, uB, uA);
%    state = state || is_uc;
%end

%predictions
if ~state
    preds = MakeNpredictions(Xj,pc);
else
    st = 2;
    return;
end

end