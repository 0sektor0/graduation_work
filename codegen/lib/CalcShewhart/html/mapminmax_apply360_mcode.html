<html>
<body>
<script src="resources/eml_report_loadable_data.js"></script>
<div class="dead">
<pre class="code">
<span class="srcline"><span class="lineno"><a href="74,1" id="srcline1">  1</a></span><span class="line">function [y1,xf1,xf2] = SimulateNarxNetwork(x1,x2,xi1,xi2)</span></span>
<span class="srcline"><span class="lineno"><a href="74,2" id="srcline2">  2</a></span><span class="line"><span class="comment">%MYNEURALNETWORKFUNCTION neural network simulation function.</span></span></span>
<span class="srcline"><span class="lineno"><a href="74,3" id="srcline3">  3</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="74,4" id="srcline4">  4</a></span><span class="line"><span class="comment">% Generated by Neural Network Toolbox function genFunction, 18-Mar-2018 23:34:59.</span></span></span>
<span class="srcline"><span class="lineno"><a href="74,5" id="srcline5">  5</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="74,6" id="srcline6">  6</a></span><span class="line"><span class="comment">% [y1,xf1,xf2] = myNeuralNetworkFunction(x1,x2,xi1,xi2) takes these arguments:</span></span></span>
<span class="srcline"><span class="lineno"><a href="74,7" id="srcline7">  7</a></span><span class="line"><span class="comment">%   x1 = 1xTS matrix, input #1</span></span></span>
<span class="srcline"><span class="lineno"><a href="74,8" id="srcline8">  8</a></span><span class="line"><span class="comment">%   x2 = 1xTS matrix, input #2</span></span></span>
<span class="srcline"><span class="lineno"><a href="74,9" id="srcline9">  9</a></span><span class="line"><span class="comment">%   xi1 = 1x5 matrix, initial 5 delay states for input #1.</span></span></span>
<span class="srcline"><span class="lineno"><a href="74,10" id="srcline10"> 10</a></span><span class="line"><span class="comment">%   xi2 = 1x5 matrix, initial 5 delay states for input #2.</span></span></span>
<span class="srcline"><span class="lineno"><a href="74,11" id="srcline11"> 11</a></span><span class="line"><span class="comment">% and returns:</span></span></span>
<span class="srcline"><span class="lineno"><a href="74,12" id="srcline12"> 12</a></span><span class="line"><span class="comment">%   y1 = 1xTS matrix, output #1</span></span></span>
<span class="srcline"><span class="lineno"><a href="74,13" id="srcline13"> 13</a></span><span class="line"><span class="comment">%   xf1 = 1x5 matrix, final 5 delay states for input #1.</span></span></span>
<span class="srcline"><span class="lineno"><a href="74,14" id="srcline14"> 14</a></span><span class="line"><span class="comment">%   xf2 = 1x5 matrix, final 5 delay states for input #2.</span></span></span>
<span class="srcline"><span class="lineno"><a href="74,15" id="srcline15"> 15</a></span><span class="line"><span class="comment">% where TS is the number of timesteps.</span></span></span>
<span class="srcline"><span class="lineno"><a href="74,16" id="srcline16"> 16</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="74,17" id="srcline17"> 17</a></span><span class="line"><span class="comment">% ===== NEURAL NETWORK CONSTANTS =====</span></span></span>
<span class="srcline"><span class="lineno"><a href="74,18" id="srcline18"> 18</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="74,19" id="srcline19"> 19</a></span><span class="line"><span class="comment">% Input 1</span></span></span>
<span class="srcline"><span class="lineno"><a href="74,20" id="srcline20"> 20</a></span><span class="line">x1_step1.xoffset = -0.999999682931835;</span></span>
<span class="srcline"><span class="lineno"><a href="74,21" id="srcline21"> 21</a></span><span class="line">x1_step1.gain = 1.00000031706827;</span></span>
<span class="srcline"><span class="lineno"><a href="74,22" id="srcline22"> 22</a></span><span class="line">x1_step1.ymin = -1;</span></span>
<span class="srcline"><span class="lineno"><a href="74,23" id="srcline23"> 23</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="74,24" id="srcline24"> 24</a></span><span class="line"><span class="comment">% Input 2</span></span></span>
<span class="srcline"><span class="lineno"><a href="74,25" id="srcline25"> 25</a></span><span class="line">x2_step1.xoffset = -0.999999682931835;</span></span>
<span class="srcline"><span class="lineno"><a href="74,26" id="srcline26"> 26</a></span><span class="line">x2_step1.gain = 1.00000031706827;</span></span>
<span class="srcline"><span class="lineno"><a href="74,27" id="srcline27"> 27</a></span><span class="line">x2_step1.ymin = -1;</span></span>
<span class="srcline"><span class="lineno"><a href="74,28" id="srcline28"> 28</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="74,29" id="srcline29"> 29</a></span><span class="line"><span class="comment">% Layer 1</span></span></span>
<span class="srcline"><span class="lineno"><a href="74,30" id="srcline30"> 30</a></span><span class="line">b1 = [-1.3922910334749807326;-1.2243227026298271198;-1.161643411359166711;0.67333631182990638653;0.16568973433063080569;-0.21123017491985102145;0.26311886693415992289;-0.87640070521585855534;1.4094979073865545605;1.7429300475993962927];</span></span>
<span class="srcline"><span class="lineno"><a href="74,31" id="srcline31"> 31</a></span><span class="line">IW1_1 = [0.061118274114390067075 0.8298497049046560381 0.37370421384758467642 -0.158751734216084045 -0.78490825315753975921;0.45245729087246855382 -0.1788464029878837902 0.80476647981130877696 -0.40976660375266277248 0.73545036441467237509;0.064998207764566690026 0.10205876785931218553 0.60539502572113679246 0.54300672037422426097 0.49148973155308195437;-0.77623308042818206509 0.61855950507032730901 -0.052556936312140610512 0.59196247108706867568 0.56947784560221326178;-0.18375679513183668101 0.7987344121367537797 0.46134689481393692523 0.78759242653206218421 -0.44865558935127902718;0.3557541390720725949 0.44635436329409816647 -0.16275726759675654409 0.23238495186979110652 0.56026273558967631949;-0.031054031701868399507 -0.70233273371579374444 0.83740650216391565586 0.046342999217160077419 0.15312539286570189812;-0.37954870166977433543 0.17579939418324624922 0.82084738939122636747 -0.53515672416150283919 -0.50444865429346774643;0.74836593250336136407 -0.92172594699906729154 0.63475361457385315322 0.71826071648196210262 -0.22617740060867175256;0.80988420411757133799 -0.14680215324128653709 -0.19175535558190129337 -0.058057948077309746993 -0.4570878200807355074];</span></span>
<span class="srcline"><span class="lineno"><a href="74,32" id="srcline32"> 32</a></span><span class="line">IW1_2 = [0.48007240060049333197 -0.50577944426525867083 0.74243581436767869253 0.34981797347828991196 -0.54753566571526457452;-0.32655555053651469377 -0.026470156442869152702 -0.26280911762015801703 0.83503738209305189422 -0.8236142368438069683;0.80575443384963607585 0.38235123028352996366 -0.70142826323808360467 0.40021028762755889163 -0.023251768225536494777;0.58544393706798292243 0.66029601732771403544 -0.26797218750834256307 -0.19389039268654384429 -0.72563051376941334336;-0.31021171446756912182 0.36176753800464767075 -0.31053007116776842889 0.61073537709902703252 -0.73806147067274319173;-0.057709205351858104682 -1.2496335893106431669 0.13455419846262481332 -0.88581854010554228473 0.41872332846062687572;0.35178193520485390167 0.28351044798211488818 0.02510775264902168763 -1.0292477683266567645 0.57982720873662252359;0.3333973535015349321 -0.26664420612800932009 -0.26429502651768754795 -0.72055484570004180167 0.87255553506833860578;0.096473957991624059716 -0.22380988865279541344 -0.28684262815962385806 -0.72864634459582378057 0.07793405488788429647;0.24100105249987524569 -0.79424037432398786329 0.097792315813590019458 -0.33734056504732179427 1.1722430098942051568];</span></span>
<span class="srcline"><span class="lineno"><a href="74,33" id="srcline33"> 33</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="74,34" id="srcline34"> 34</a></span><span class="line"><span class="comment">% Layer 2</span></span></span>
<span class="srcline"><span class="lineno"><a href="74,35" id="srcline35"> 35</a></span><span class="line">b2 = -0.51213534382060155181;</span></span>
<span class="srcline"><span class="lineno"><a href="74,36" id="srcline36"> 36</a></span><span class="line">LW2_1 = [0.22791232026521598963 0.3562975104828735029 0.0016997302229618191372 -0.10321879935706215758 0.011173329077173058815 -1.3330986659522587878 1.0280049070402814682 -0.63293366154353070119 -0.29979747055028638236 0.37390326576799848279];</span></span>
<span class="srcline"><span class="lineno"><a href="74,37" id="srcline37"> 37</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="74,38" id="srcline38"> 38</a></span><span class="line"><span class="comment">% Output 1</span></span></span>
<span class="srcline"><span class="lineno"><a href="74,39" id="srcline39"> 39</a></span><span class="line">y1_step1.ymin = -1;</span></span>
<span class="srcline"><span class="lineno"><a href="74,40" id="srcline40"> 40</a></span><span class="line">y1_step1.gain = 1.00000031706827;</span></span>
<span class="srcline"><span class="lineno"><a href="74,41" id="srcline41"> 41</a></span><span class="line">y1_step1.xoffset = -0.999999682931835;</span></span>
<span class="srcline"><span class="lineno"><a href="74,42" id="srcline42"> 42</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="74,43" id="srcline43"> 43</a></span><span class="line"><span class="comment">% ===== SIMULATION ========</span></span></span>
<span class="srcline"><span class="lineno"><a href="74,44" id="srcline44"> 44</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="74,45" id="srcline45"> 45</a></span><span class="line"><span class="comment">% Dimensions</span></span></span>
<span class="srcline"><span class="lineno"><a href="74,46" id="srcline46"> 46</a></span><span class="line">TS = size(x1,2); <span class="comment">% timesteps</span></span></span>
<span class="srcline"><span class="lineno"><a href="74,47" id="srcline47"> 47</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="74,48" id="srcline48"> 48</a></span><span class="line"><span class="comment">% Input 1 Delay States</span></span></span>
<span class="srcline"><span class="lineno"><a href="74,49" id="srcline49"> 49</a></span><span class="line">xd1 = mapminmax_apply(xi1,x1_step1);</span></span>
<span class="srcline"><span class="lineno"><a href="74,50" id="srcline50"> 50</a></span><span class="line">xd1 = [xd1 zeros(1,1)];</span></span>
<span class="srcline"><span class="lineno"><a href="74,51" id="srcline51"> 51</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="74,52" id="srcline52"> 52</a></span><span class="line"><span class="comment">% Input 2 Delay States</span></span></span>
<span class="srcline"><span class="lineno"><a href="74,53" id="srcline53"> 53</a></span><span class="line">xd2 = mapminmax_apply(xi2,x2_step1);</span></span>
<span class="srcline"><span class="lineno"><a href="74,54" id="srcline54"> 54</a></span><span class="line">xd2 = [xd2 zeros(1,1)];</span></span>
<span class="srcline"><span class="lineno"><a href="74,55" id="srcline55"> 55</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="74,56" id="srcline56"> 56</a></span><span class="line"><span class="comment">% Allocate Outputs</span></span></span>
<span class="srcline"><span class="lineno"><a href="74,57" id="srcline57"> 57</a></span><span class="line">y1 = zeros(1,TS);</span></span>
<span class="srcline"><span class="lineno"><a href="74,58" id="srcline58"> 58</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="74,59" id="srcline59"> 59</a></span><span class="line"><span class="comment">% Time loop</span></span></span>
<span class="srcline"><span class="lineno"><a href="74,60" id="srcline60"> 60</a></span><span class="line">for ts=1:TS</span></span>
<span class="srcline"><span class="lineno"><a href="74,61" id="srcline61"> 61</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="74,62" id="srcline62"> 62</a></span><span class="line">    <span class="comment">% Rotating delay state position</span></span></span>
<span class="srcline"><span class="lineno"><a href="74,63" id="srcline63"> 63</a></span><span class="line">    xdts = mod(ts+4,6)+1;</span></span>
<span class="srcline"><span class="lineno"><a href="74,64" id="srcline64"> 64</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="74,65" id="srcline65"> 65</a></span><span class="line">    <span class="comment">% Input 1</span></span></span>
<span class="srcline"><span class="lineno"><a href="74,66" id="srcline66"> 66</a></span><span class="line">    xd1(:,xdts) = mapminmax_apply(x1(:,ts),x1_step1);</span></span>
<span class="srcline"><span class="lineno"><a href="74,67" id="srcline67"> 67</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="74,68" id="srcline68"> 68</a></span><span class="line">    <span class="comment">% Input 2</span></span></span>
<span class="srcline"><span class="lineno"><a href="74,69" id="srcline69"> 69</a></span><span class="line">    xd2(:,xdts) = mapminmax_apply(x2(:,ts),x2_step1);</span></span>
<span class="srcline"><span class="lineno"><a href="74,70" id="srcline70"> 70</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="74,71" id="srcline71"> 71</a></span><span class="line">    <span class="comment">% Layer 1</span></span></span>
<span class="srcline"><span class="lineno"><a href="74,72" id="srcline72"> 72</a></span><span class="line">    tapdelay1 = reshape(xd1(:,mod(xdts-[1 2 3 4 5]-1,6)+1),5,1);</span></span>
<span class="srcline"><span class="lineno"><a href="74,73" id="srcline73"> 73</a></span><span class="line">    tapdelay2 = reshape(xd2(:,mod(xdts-[1 2 3 4 5]-1,6)+1),5,1);</span></span>
<span class="srcline"><span class="lineno"><a href="74,74" id="srcline74"> 74</a></span><span class="line">    a1 = tansig_apply(b1 + IW1_1*tapdelay1 + IW1_2*tapdelay2);</span></span>
<span class="srcline"><span class="lineno"><a href="74,75" id="srcline75"> 75</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="74,76" id="srcline76"> 76</a></span><span class="line">    <span class="comment">% Layer 2</span></span></span>
<span class="srcline"><span class="lineno"><a href="74,77" id="srcline77"> 77</a></span><span class="line">    a2 = b2 + LW2_1*a1;</span></span>
<span class="srcline"><span class="lineno"><a href="74,78" id="srcline78"> 78</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="74,79" id="srcline79"> 79</a></span><span class="line">    <span class="comment">% Output 1</span></span></span>
<span class="srcline"><span class="lineno"><a href="74,80" id="srcline80"> 80</a></span><span class="line">    y1(:,ts) = mapminmax_reverse(a2,y1_step1);</span></span>
<span class="srcline"><span class="lineno"><a href="74,81" id="srcline81"> 81</a></span><span class="line">end</span></span>
<span class="srcline"><span class="lineno"><a href="74,82" id="srcline82"> 82</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="74,83" id="srcline83"> 83</a></span><span class="line"><span class="comment">% Final delay states</span></span></span>
<span class="srcline"><span class="lineno"><a href="74,84" id="srcline84"> 84</a></span><span class="line">finalxts = TS+(1: 5);</span></span>
<span class="srcline"><span class="lineno"><a href="74,85" id="srcline85"> 85</a></span><span class="line">xits = finalxts(finalxts&lt;=5);</span></span>
<span class="srcline"><span class="lineno"><a href="74,86" id="srcline86"> 86</a></span><span class="line">xts = finalxts(finalxts&gt;5)-5;</span></span>
<span class="srcline"><span class="lineno"><a href="74,87" id="srcline87"> 87</a></span><span class="line">xf1 = [xi1(:,xits) x1(:,xts)];</span></span>
<span class="srcline"><span class="lineno"><a href="74,88" id="srcline88"> 88</a></span><span class="line">xf2 = [xi2(:,xits) x2(:,xts)];</span></span>
<span class="srcline"><span class="lineno"><a href="74,89" id="srcline89"> 89</a></span><span class="line">end</span></span>
</pre>
</div>
<pre class="code">
<span class="srcline"><span class="lineno"><a href="74,90" id="srcline90"> 90</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="74,91" id="srcline91"> 91</a></span><span class="line"><span class="comment">% ===== MODULE FUNCTIONS ========</span></span></span>
<span class="srcline"><span class="lineno"><a href="74,92" id="srcline92"> 92</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="74,93" id="srcline93"> 93</a></span><span class="line"><span class="comment">% Map Minimum and Maximum Input Processing Function</span></span></span>
<span class="srcline"><span class="lineno"><a href="74,94" id="srcline94"> 94</a></span><span class="line"><span class="keyword">function</span> <span class="var type1" id="S37T1U529">y</span> = mapminmax_apply(<span class="var type1" id="S38T1U532">x</span>,<span class="var type1" id="S39T59U533">settings</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="74,95" id="srcline95"> 95</a></span><span class="line"><span class="mxinfo " id="T1:U4"><span class="var type1" id="S37T1U536">y</span> = <span class="mxinfo " id="T1:U6">bsxfun(@minus,<span class="var type1" id="S38T1U541">x</span>,<span class="mxinfo " id="T1:U8"><span class="var type1" id="S39T59U543">settings</span>.xoffset</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="74,96" id="srcline96"> 96</a></span><span class="line"><span class="mxinfo " id="T1:U10"><span class="var type1" id="S37T1U547">y</span> = <span class="mxinfo " id="T1:U12">bsxfun(@times,<span class="var type1" id="S37T1U552">y</span>,<span class="mxinfo " id="T1:U14"><span class="var type1" id="S39T59U554">settings</span>.gain</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="74,97" id="srcline97"> 97</a></span><span class="line"><span class="mxinfo " id="T1:U16"><span class="var type1" id="S37T1U558">y</span> = <span class="mxinfo " id="T1:U18">bsxfun(@plus,<span class="var type1" id="S37T1U563">y</span>,<span class="mxinfo " id="T1:U20"><span class="var type1" id="S39T59U565">settings</span>.ymin</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="74,98" id="srcline98"> 98</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="74,99" id="srcline99"> 99</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="74,100" id="srcline100">100</a></span><span class="line"><span class="comment">% Sigmoid Symmetric Transfer Function</span></span></span>
</pre>
<div class="dead">
<pre class="code">
<span class="srcline"><span class="lineno"><a href="74,101" id="srcline101">101</a></span><span class="line">function a = tansig_apply(n,~)</span></span>
<span class="srcline"><span class="lineno"><a href="74,102" id="srcline102">102</a></span><span class="line">a = 2 ./ (1 + exp(-2*n)) - 1;</span></span>
<span class="srcline"><span class="lineno"><a href="74,103" id="srcline103">103</a></span><span class="line">end</span></span>
<span class="srcline"><span class="lineno"><a href="74,104" id="srcline104">104</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="74,105" id="srcline105">105</a></span><span class="line"><span class="comment">% Map Minimum and Maximum Output Reverse-Processing Function</span></span></span>
<span class="srcline"><span class="lineno"><a href="74,106" id="srcline106">106</a></span><span class="line">function x = mapminmax_reverse(y,settings)</span></span>
<span class="srcline"><span class="lineno"><a href="74,107" id="srcline107">107</a></span><span class="line">x = bsxfun(@minus,y,settings.ymin);</span></span>
<span class="srcline"><span class="lineno"><a href="74,108" id="srcline108">108</a></span><span class="line">x = bsxfun(@rdivide,x,settings.gain);</span></span>
<span class="srcline"><span class="lineno"><a href="74,109" id="srcline109">109</a></span><span class="line">x = bsxfun(@plus,x,settings.xoffset);</span></span>
<span class="srcline"><span class="lineno"><a href="74,110" id="srcline110">110</a></span><span class="line">end</span></span>
<span class="srcline"><span class="lineno"><a href="74,111" id="srcline111">111</a></span><span class="line"> </span></span>
</pre>
</div>
</body>
</html>
