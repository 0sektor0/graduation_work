<html>
<body>
<script src="resources/eml_report_loadable_data.js"></script>
<div class="dead">
<pre class="code">
<span class="srcline"><span class="lineno"><a href="80,1" id="srcline1">  1</a></span><span class="line">function [y1,xf1,xf2] = SimulateNarx(x1,x2,xi1,xi2)</span></span>
<span class="srcline"><span class="lineno"><a href="80,2" id="srcline2">  2</a></span><span class="line"><span class="comment">%MYNEURALNETWORKFUNCTION neural network simulation function.</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,3" id="srcline3">  3</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,4" id="srcline4">  4</a></span><span class="line"><span class="comment">% Generated by Neural Network Toolbox function genFunction, 05-Mar-2018 02:03:52.</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,5" id="srcline5">  5</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,6" id="srcline6">  6</a></span><span class="line"><span class="comment">% [y1,xf1,xf2] = myNeuralNetworkFunction(x1,x2,xi1,xi2) takes these arguments:</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,7" id="srcline7">  7</a></span><span class="line"><span class="comment">%   x1 = 1xTS matrix, input #1</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,8" id="srcline8">  8</a></span><span class="line"><span class="comment">%   x2 = 1xTS matrix, input #2</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,9" id="srcline9">  9</a></span><span class="line"><span class="comment">%   xi1 = 1x5 matrix, initial 5 delay states for input #1.</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,10" id="srcline10"> 10</a></span><span class="line"><span class="comment">%   xi2 = 1x5 matrix, initial 5 delay states for input #2.</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,11" id="srcline11"> 11</a></span><span class="line"><span class="comment">% and returns:</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,12" id="srcline12"> 12</a></span><span class="line"><span class="comment">%   y1 = 1xTS matrix, output #1</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,13" id="srcline13"> 13</a></span><span class="line"><span class="comment">%   xf1 = 1x5 matrix, final 5 delay states for input #1.</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,14" id="srcline14"> 14</a></span><span class="line"><span class="comment">%   xf2 = 1x5 matrix, final 5 delay states for input #2.</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,15" id="srcline15"> 15</a></span><span class="line"><span class="comment">% where TS is the number of timesteps.</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,16" id="srcline16"> 16</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="80,17" id="srcline17"> 17</a></span><span class="line"><span class="comment">% ===== NEURAL NETWORK CONSTANTS =====</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,18" id="srcline18"> 18</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="80,19" id="srcline19"> 19</a></span><span class="line"><span class="comment">% Input 1</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,20" id="srcline20"> 20</a></span><span class="line">x1_step1.xoffset = 1;</span></span>
<span class="srcline"><span class="lineno"><a href="80,21" id="srcline21"> 21</a></span><span class="line">x1_step1.gain = 0.002002002002002;</span></span>
<span class="srcline"><span class="lineno"><a href="80,22" id="srcline22"> 22</a></span><span class="line">x1_step1.ymin = -1;</span></span>
<span class="srcline"><span class="lineno"><a href="80,23" id="srcline23"> 23</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="80,24" id="srcline24"> 24</a></span><span class="line"><span class="comment">% Input 2</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,25" id="srcline25"> 25</a></span><span class="line">x2_step1.xoffset = 2;</span></span>
<span class="srcline"><span class="lineno"><a href="80,26" id="srcline26"> 26</a></span><span class="line">x2_step1.gain = 0.002002002002002;</span></span>
<span class="srcline"><span class="lineno"><a href="80,27" id="srcline27"> 27</a></span><span class="line">x2_step1.ymin = -1;</span></span>
<span class="srcline"><span class="lineno"><a href="80,28" id="srcline28"> 28</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="80,29" id="srcline29"> 29</a></span><span class="line"><span class="comment">% Layer 1</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,30" id="srcline30"> 30</a></span><span class="line">b1 = [-1.7090172203160829412;-1.434661824735476765;-1.0248798375554910578;0.15187863316150465587;-0.11704147597611042064;-0.058363867728379856259;-0.54156627864489514934;-1.0316357902912727251;-1.2617032608578859776;-1.8689621535231204508];</span></span>
<span class="srcline"><span class="lineno"><a href="80,31" id="srcline31"> 31</a></span><span class="line">IW1_1 = [0.15953178999074935085 -0.62226452507399598879 0.060830731347264417608 -0.77558313935781708626 -0.8511310528827321642;1.0665109884445469479 -0.081450026684921489339 0.27459298178719604433 -0.35222423784098749744 -1.0097215316539378538;0.48709849061539817194 0.27820680189382912539 0.58772234409607582162 0.656870082645066522 0.14048086017385971735;-0.46488478584157094664 0.089763777097414815254 -0.5763531722551937797 0.39344424906312008838 -0.27872934599624055174;-0.2652232776466298958 -0.68559072010026433919 -0.022421095150856204525 -0.49760954913419497281 0.36874192995875959555;0.40742763723298835998 0.4763043935449916555 -0.3629398805735296607 -1.0732853474200998445 0.29454685909198069504;-0.64433502300773415339 -0.9052049017899926886 -0.94167174055582059111 -0.50845089441451396528 -0.20712011737187976945;-0.2962715390588603892 -0.74263365445905271667 0.40514869461448499433 0.4717451173631014294 -0.50966222731695620674;-0.51631884461305388445 0.7694005170538716909 0.58626058298144778647 -0.097486366025991755269 0.096143620520296763088;-0.67110069290497231798 0.46318581921767770782 0.5152867967407451788 0.90375770290899815063 0.64160533728983637491];</span></span>
<span class="srcline"><span class="lineno"><a href="80,32" id="srcline32"> 32</a></span><span class="line">IW1_2 = [0.61487828302025848703 -0.70794674024522541433 -0.44789323152365934089 0.25969355851680625547 0.24085764928703573551;-0.24702381325767933107 -0.26576124870071260453 0.58310493885226288846 -0.37176500274580615013 -0.30066683680964495506;-0.22656814745680620149 0.27659540722185044226 0.80571687939104064125 -0.84451376141083323024 -0.20773793129614079311;0.84498868752507905189 -0.4437390559545442148 -0.56943084565509938244 0.76222722429431777336 -0.37701152227248752036;0.606138725313992488 0.59142650823268105853 -0.79282392827066772156 0.71190089804275324958 -0.60236911339393817144;0.33934073764760885883 -0.19666201233376645607 0.20399427948173928793 0.84854120256203158235 0.036192038533045714499;-0.59932709214792923014 0.064315096078469677354 0.12319735013463742335 -0.59545680144108992238 -0.18053667735575659736;-0.84744939854136402957 -0.82408525969485146856 -0.52232718653572296486 -0.26706284679096115031 -0.39380553917637639572;-0.77038388509369848389 -0.67226618897118661788 0.81173112134442448884 0.45821689805859794342 -0.050168609551875638364;-0.24029552282126775964 -0.62304276505939881758 0.091271865071466312669 -0.62730015198289845735 -0.0042620415811663436151];</span></span>
<span class="srcline"><span class="lineno"><a href="80,33" id="srcline33"> 33</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="80,34" id="srcline34"> 34</a></span><span class="line"><span class="comment">% Layer 2</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,35" id="srcline35"> 35</a></span><span class="line">b2 = 0.6978369957554244607;</span></span>
<span class="srcline"><span class="lineno"><a href="80,36" id="srcline36"> 36</a></span><span class="line">LW2_1 = [-0.0011230187451937237181 -0.94577252909427667049 -0.00050514245379962004288 -0.4778234232333447018 -0.81217673682454893935 -0.090880500192812768701 3.9656810838924306143e-06 1.8644970577760549711e-05 0.94660653772540304107 0.79011075296776689392];</span></span>
<span class="srcline"><span class="lineno"><a href="80,37" id="srcline37"> 37</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="80,38" id="srcline38"> 38</a></span><span class="line"><span class="comment">% Output 1</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,39" id="srcline39"> 39</a></span><span class="line">y1_step1.ymin = -1;</span></span>
<span class="srcline"><span class="lineno"><a href="80,40" id="srcline40"> 40</a></span><span class="line">y1_step1.gain = 0.002002002002002;</span></span>
<span class="srcline"><span class="lineno"><a href="80,41" id="srcline41"> 41</a></span><span class="line">y1_step1.xoffset = 2;</span></span>
<span class="srcline"><span class="lineno"><a href="80,42" id="srcline42"> 42</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="80,43" id="srcline43"> 43</a></span><span class="line"><span class="comment">% ===== SIMULATION ========</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,44" id="srcline44"> 44</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="80,45" id="srcline45"> 45</a></span><span class="line"><span class="comment">% Dimensions</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,46" id="srcline46"> 46</a></span><span class="line">TS = size(x1,2); <span class="comment">% timesteps</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,47" id="srcline47"> 47</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="80,48" id="srcline48"> 48</a></span><span class="line"><span class="comment">% Input 1 Delay States</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,49" id="srcline49"> 49</a></span><span class="line">xd1 = mapminmax_apply(xi1,x1_step1);</span></span>
<span class="srcline"><span class="lineno"><a href="80,50" id="srcline50"> 50</a></span><span class="line">xd1 = [xd1 zeros(1,1)];</span></span>
<span class="srcline"><span class="lineno"><a href="80,51" id="srcline51"> 51</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="80,52" id="srcline52"> 52</a></span><span class="line"><span class="comment">% Input 2 Delay States</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,53" id="srcline53"> 53</a></span><span class="line">xd2 = mapminmax_apply(xi2,x2_step1);</span></span>
<span class="srcline"><span class="lineno"><a href="80,54" id="srcline54"> 54</a></span><span class="line">xd2 = [xd2 zeros(1,1)];</span></span>
<span class="srcline"><span class="lineno"><a href="80,55" id="srcline55"> 55</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="80,56" id="srcline56"> 56</a></span><span class="line"><span class="comment">% Allocate Outputs</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,57" id="srcline57"> 57</a></span><span class="line">y1 = zeros(1,TS);</span></span>
<span class="srcline"><span class="lineno"><a href="80,58" id="srcline58"> 58</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="80,59" id="srcline59"> 59</a></span><span class="line"><span class="comment">% Time loop</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,60" id="srcline60"> 60</a></span><span class="line">for ts=1:TS</span></span>
<span class="srcline"><span class="lineno"><a href="80,61" id="srcline61"> 61</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="80,62" id="srcline62"> 62</a></span><span class="line">    <span class="comment">% Rotating delay state position</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,63" id="srcline63"> 63</a></span><span class="line">    xdts = mod(ts+4,6)+1;</span></span>
<span class="srcline"><span class="lineno"><a href="80,64" id="srcline64"> 64</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="80,65" id="srcline65"> 65</a></span><span class="line">    <span class="comment">% Input 1</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,66" id="srcline66"> 66</a></span><span class="line">    xd1(:,xdts) = mapminmax_apply(x1(:,ts),x1_step1);</span></span>
<span class="srcline"><span class="lineno"><a href="80,67" id="srcline67"> 67</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="80,68" id="srcline68"> 68</a></span><span class="line">    <span class="comment">% Input 2</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,69" id="srcline69"> 69</a></span><span class="line">    xd2(:,xdts) = mapminmax_apply(x2(:,ts),x2_step1);</span></span>
<span class="srcline"><span class="lineno"><a href="80,70" id="srcline70"> 70</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="80,71" id="srcline71"> 71</a></span><span class="line">    <span class="comment">% Layer 1</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,72" id="srcline72"> 72</a></span><span class="line">    tapdelay1 = reshape(xd1(:,mod(xdts-[1 2 3 4 5]-1,6)+1),5,1);</span></span>
<span class="srcline"><span class="lineno"><a href="80,73" id="srcline73"> 73</a></span><span class="line">    tapdelay2 = reshape(xd2(:,mod(xdts-[1 2 3 4 5]-1,6)+1),5,1);</span></span>
<span class="srcline"><span class="lineno"><a href="80,74" id="srcline74"> 74</a></span><span class="line">    a1 = tansig_apply(b1 + IW1_1*tapdelay1 + IW1_2*tapdelay2);</span></span>
<span class="srcline"><span class="lineno"><a href="80,75" id="srcline75"> 75</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="80,76" id="srcline76"> 76</a></span><span class="line">    <span class="comment">% Layer 2</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,77" id="srcline77"> 77</a></span><span class="line">    a2 = b2 + LW2_1*a1;</span></span>
<span class="srcline"><span class="lineno"><a href="80,78" id="srcline78"> 78</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="80,79" id="srcline79"> 79</a></span><span class="line">    <span class="comment">% Output 1</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,80" id="srcline80"> 80</a></span><span class="line">    y1(:,ts) = mapminmax_reverse(a2,y1_step1);</span></span>
<span class="srcline"><span class="lineno"><a href="80,81" id="srcline81"> 81</a></span><span class="line">end</span></span>
<span class="srcline"><span class="lineno"><a href="80,82" id="srcline82"> 82</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="80,83" id="srcline83"> 83</a></span><span class="line"><span class="comment">% Final delay states</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,84" id="srcline84"> 84</a></span><span class="line">finalxts = TS+(1: 5);</span></span>
<span class="srcline"><span class="lineno"><a href="80,85" id="srcline85"> 85</a></span><span class="line">xits = finalxts(finalxts&lt;=5);</span></span>
<span class="srcline"><span class="lineno"><a href="80,86" id="srcline86"> 86</a></span><span class="line">xts = finalxts(finalxts&gt;5)-5;</span></span>
<span class="srcline"><span class="lineno"><a href="80,87" id="srcline87"> 87</a></span><span class="line">xf1 = [xi1(:,xits) x1(:,xts)];</span></span>
<span class="srcline"><span class="lineno"><a href="80,88" id="srcline88"> 88</a></span><span class="line">xf2 = [xi2(:,xits) x2(:,xts)];</span></span>
<span class="srcline"><span class="lineno"><a href="80,89" id="srcline89"> 89</a></span><span class="line">end</span></span>
</pre>
</div>
<pre class="code">
<span class="srcline"><span class="lineno"><a href="80,90" id="srcline90"> 90</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="80,91" id="srcline91"> 91</a></span><span class="line"><span class="comment">% ===== MODULE FUNCTIONS ========</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,92" id="srcline92"> 92</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="80,93" id="srcline93"> 93</a></span><span class="line"><span class="comment">% Map Minimum and Maximum Input Processing Function</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,94" id="srcline94"> 94</a></span><span class="line"><span class="keyword">function</span> <span class="var type1" id="S37T3U541">y</span> = mapminmax_apply(<span class="var type1" id="S38T3U544">x</span>,<span class="var type1" id="S39T54U545">settings</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="80,95" id="srcline95"> 95</a></span><span class="line"><span class="mxinfo " id="T3:U4"><span class="var type1" id="S37T3U548">y</span> = <span class="mxinfo " id="T3:U6">bsxfun(@minus,<span class="var type1" id="S38T3U553">x</span>,<span class="mxinfo " id="T3:U8"><span class="var type1" id="S39T54U555">settings</span>.xoffset</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="80,96" id="srcline96"> 96</a></span><span class="line"><span class="mxinfo " id="T3:U10"><span class="var type1" id="S37T3U559">y</span> = <span class="mxinfo " id="T3:U12">bsxfun(@times,<span class="var type1" id="S37T3U564">y</span>,<span class="mxinfo " id="T3:U14"><span class="var type1" id="S39T54U566">settings</span>.gain</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="80,97" id="srcline97"> 97</a></span><span class="line"><span class="mxinfo " id="T3:U16"><span class="var type1" id="S37T3U570">y</span> = <span class="mxinfo " id="T3:U18">bsxfun(@plus,<span class="var type1" id="S37T3U575">y</span>,<span class="mxinfo " id="T3:U20"><span class="var type1" id="S39T54U577">settings</span>.ymin</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="80,98" id="srcline98"> 98</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,99" id="srcline99"> 99</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="80,100" id="srcline100">100</a></span><span class="line"><span class="comment">% Sigmoid Symmetric Transfer Function</span></span></span>
</pre>
<div class="dead">
<pre class="code">
<span class="srcline"><span class="lineno"><a href="80,101" id="srcline101">101</a></span><span class="line">function a = tansig_apply(n,~)</span></span>
<span class="srcline"><span class="lineno"><a href="80,102" id="srcline102">102</a></span><span class="line">a = 2 ./ (1 + exp(-2*n)) - 1;</span></span>
<span class="srcline"><span class="lineno"><a href="80,103" id="srcline103">103</a></span><span class="line">end</span></span>
<span class="srcline"><span class="lineno"><a href="80,104" id="srcline104">104</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="80,105" id="srcline105">105</a></span><span class="line"><span class="comment">% Map Minimum and Maximum Output Reverse-Processing Function</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,106" id="srcline106">106</a></span><span class="line">function x = mapminmax_reverse(y,settings)</span></span>
<span class="srcline"><span class="lineno"><a href="80,107" id="srcline107">107</a></span><span class="line">x = bsxfun(@minus,y,settings.ymin);</span></span>
<span class="srcline"><span class="lineno"><a href="80,108" id="srcline108">108</a></span><span class="line">x = bsxfun(@rdivide,x,settings.gain);</span></span>
<span class="srcline"><span class="lineno"><a href="80,109" id="srcline109">109</a></span><span class="line">x = bsxfun(@plus,x,settings.xoffset);</span></span>
<span class="srcline"><span class="lineno"><a href="80,110" id="srcline110">110</a></span><span class="line">end</span></span>
<span class="srcline"><span class="lineno"><a href="80,111" id="srcline111">111</a></span><span class="line"> </span></span>
</pre>
</div>
</body>
</html>
